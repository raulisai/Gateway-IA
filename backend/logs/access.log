2026-01-13 23:47:22,826 - app.core.middleware - INFO - REQ_START: GET /docs
2026-01-13 23:47:22,829 - app.core.middleware - INFO - REQ_END: GET /docs Status: 200 Duration: 2.61ms
2026-01-13 23:47:22,920 - app.core.middleware - INFO - REQ_START: GET /api/v1/openapi.json
2026-01-13 23:47:22,965 - app.core.middleware - INFO - REQ_END: GET /api/v1/openapi.json Status: 200 Duration: 45.09ms
2026-01-14 00:52:32,890 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:52:33,199 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 309.37ms
2026-01-14 00:52:33,201 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:52:33,204 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:52:33,469 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 264.21ms
2026-01-14 00:52:33,469 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:52:33,470 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:52:33,474 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:52:33,474 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 3.53ms
2026-01-14 00:52:33,475 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:52:46,468 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:52:46,496 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:52:46,496 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 27.83ms
2026-01-14 00:52:46,497 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:52:46,497 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:52:46,501 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:52:46,501 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 4.25ms
2026-01-14 00:52:46,503 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:54:48,583 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:54:48,591 - app.core.errors - WARNING - Validation error at http://test/api/v1/auth/signup: [{'type': 'value_error', 'loc': ('body', 'password'), 'msg': 'Value error, Password must contain at least one uppercase letter', 'input': 'strongpassword123', 'ctx': {'error': ValueError('Password must contain at least one uppercase letter')}, 'url': 'https://errors.pydantic.dev/2.10/v/value_error'}]
2026-01-14 00:54:48,591 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 422 Duration: 8.73ms
2026-01-14 00:54:48,593 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2026-01-14 00:54:48,843 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:54:48,848 - app.core.errors - WARNING - Validation error at http://test/api/v1/auth/signup: [{'type': 'value_error', 'loc': ('body', 'password'), 'msg': 'Value error, Password must contain at least one uppercase letter', 'input': 'password123', 'ctx': {'error': ValueError('Password must contain at least one uppercase letter')}, 'url': 'https://errors.pydantic.dev/2.10/v/value_error'}]
2026-01-14 00:54:48,849 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 422 Duration: 5.46ms
2026-01-14 00:54:48,850 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2026-01-14 00:54:48,850 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:54:48,855 - app.core.errors - WARNING - Validation error at http://test/api/v1/auth/signup: [{'type': 'value_error', 'loc': ('body', 'password'), 'msg': 'Value error, Password must contain at least one uppercase letter', 'input': 'password123', 'ctx': {'error': ValueError('Password must contain at least one uppercase letter')}, 'url': 'https://errors.pydantic.dev/2.10/v/value_error'}]
2026-01-14 00:54:48,855 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 422 Duration: 4.28ms
2026-01-14 00:54:48,857 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2026-01-14 00:56:32,321 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:56:32,346 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:56:32,346 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 24.91ms
2026-01-14 00:56:32,347 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:56:32,355 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:56:32,360 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:56:32,362 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 6.20ms
2026-01-14 00:56:32,362 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:56:32,363 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:56:32,366 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:56:32,367 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 4.22ms
2026-01-14 00:56:32,367 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:56:33,507 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:56:33,512 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:56:33,512 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 5.61ms
2026-01-14 00:56:33,513 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:56:33,514 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:56:33,764 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/login: Incorrect email or password
2026-01-14 00:56:33,764 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 400 Duration: 250.16ms
2026-01-14 00:56:33,766 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 400 Bad Request"
2026-01-14 00:56:33,774 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:56:33,778 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:56:33,778 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 4.13ms
2026-01-14 00:56:33,779 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:56:33,779 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:56:34,022 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/login: Incorrect email or password
2026-01-14 00:56:34,022 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 400 Duration: 243.18ms
2026-01-14 00:56:34,023 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 400 Bad Request"
2026-01-14 00:56:34,029 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:56:34,290 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 260.71ms
2026-01-14 00:56:34,290 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:56:34,293 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:56:34,550 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 256.17ms
2026-01-14 00:56:34,550 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:56:34,550 - app.core.middleware - INFO - REQ_START: POST /api/v1/keys/
2026-01-14 00:56:34,564 - app.core.middleware - INFO - REQ_END: POST /api/v1/keys/ Status: 200 Duration: 14.79ms
2026-01-14 00:56:34,566 - httpx - INFO - HTTP Request: POST http://test/api/v1/keys/ "HTTP/1.1 200 OK"
2026-01-14 00:56:34,566 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/
2026-01-14 00:56:34,573 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/ Status: 200 Duration: 6.60ms
2026-01-14 00:56:34,574 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/ "HTTP/1.1 200 OK"
2026-01-14 00:56:34,574 - app.core.middleware - INFO - REQ_START: DELETE /api/v1/keys/8709b391-c779-4502-b198-f0bc24270284
2026-01-14 00:56:34,591 - app.core.middleware - INFO - REQ_END: DELETE /api/v1/keys/8709b391-c779-4502-b198-f0bc24270284 Status: 200 Duration: 17.10ms
2026-01-14 00:56:34,592 - httpx - INFO - HTTP Request: DELETE http://test/api/v1/keys/8709b391-c779-4502-b198-f0bc24270284 "HTTP/1.1 200 OK"
2026-01-14 00:56:34,592 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/
2026-01-14 00:56:34,597 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/ Status: 200 Duration: 5.03ms
2026-01-14 00:56:34,599 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/ "HTTP/1.1 200 OK"
2026-01-14 00:56:34,610 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:56:34,858 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 248.20ms
2026-01-14 00:56:34,859 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:56:34,859 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:56:35,103 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 244.01ms
2026-01-14 00:56:35,105 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:56:35,105 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/logout
2026-01-14 00:56:35,120 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/logout Status: 200 Duration: 15.18ms
2026-01-14 00:56:35,121 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/logout "HTTP/1.1 200 OK"
2026-01-14 00:56:35,122 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/logout
2026-01-14 00:56:35,125 - app.core.errors - WARNING - HTTP error 401 at http://test/api/v1/auth/logout: Token has been revoked
2026-01-14 00:56:35,125 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/logout Status: 401 Duration: 2.83ms
2026-01-14 00:56:35,127 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/logout "HTTP/1.1 401 Unauthorized"
2026-01-14 00:56:35,131 - app.core.middleware - INFO - REQ_START: GET /health
2026-01-14 00:56:35,132 - app.core.middleware - INFO - REQ_END: GET /health Status: 200 Duration: 1.54ms
2026-01-14 00:56:35,133 - httpx - INFO - HTTP Request: GET http://test/health "HTTP/1.1 200 OK"
2026-01-14 00:56:35,149 - app.core.middleware - INFO - REQ_START: GET /
2026-01-14 00:56:35,150 - app.core.middleware - INFO - REQ_END: GET / Status: 200 Duration: 0.52ms
2026-01-14 00:56:35,151 - httpx - INFO - HTTP Request: GET http://test/ "HTTP/1.1 200 OK"
2026-01-14 00:56:35,157 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:56:35,421 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 264.50ms
2026-01-14 00:56:35,422 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:56:35,423 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:56:35,665 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 241.95ms
2026-01-14 00:56:35,665 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:56:35,667 - app.core.middleware - INFO - REQ_START: POST /api/v1/keys/providers/add
2026-01-14 00:56:35,687 - app.core.middleware - INFO - REQ_END: POST /api/v1/keys/providers/add Status: 200 Duration: 19.55ms
2026-01-14 00:56:35,687 - httpx - INFO - HTTP Request: POST http://test/api/v1/keys/providers/add "HTTP/1.1 200 OK"
2026-01-14 00:56:35,687 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/providers/list
2026-01-14 00:56:35,693 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/providers/list Status: 200 Duration: 6.32ms
2026-01-14 00:56:35,694 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/providers/list "HTTP/1.1 200 OK"
2026-01-14 00:56:35,694 - app.core.middleware - INFO - REQ_START: DELETE /api/v1/keys/providers/9964e758-684a-4d95-942a-41d363c091c6
2026-01-14 00:56:35,706 - app.core.middleware - INFO - REQ_END: DELETE /api/v1/keys/providers/9964e758-684a-4d95-942a-41d363c091c6 Status: 200 Duration: 11.78ms
2026-01-14 00:56:35,707 - httpx - INFO - HTTP Request: DELETE http://test/api/v1/keys/providers/9964e758-684a-4d95-942a-41d363c091c6 "HTTP/1.1 200 OK"
2026-01-14 00:56:35,707 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/providers/list
2026-01-14 00:56:35,711 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/providers/list Status: 200 Duration: 4.56ms
2026-01-14 00:56:35,713 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/providers/list "HTTP/1.1 200 OK"
2026-01-14 00:56:36,828 - app.core.registry - INFO - Loaded 1 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 00:56:36,833 - app.core.registry - INFO - Loaded 1 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 00:56:36,837 - app.core.registry - INFO - Loaded 1 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 00:56:37,947 - app.core.registry - INFO - Loaded 2 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 00:56:38,974 - app.core.middleware - INFO - REQ_START: GET /api/v1/analytics/overview
2026-01-14 00:56:38,981 - app.core.middleware - INFO - REQ_END: GET /api/v1/analytics/overview Status: 200 Duration: 7.70ms
2026-01-14 00:56:38,983 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/analytics/overview "HTTP/1.1 200 OK"
2026-01-14 00:56:38,987 - app.core.middleware - INFO - REQ_START: GET /api/v1/analytics/cost-breakdown
2026-01-14 00:56:38,993 - app.core.middleware - INFO - REQ_END: GET /api/v1/analytics/cost-breakdown Status: 200 Duration: 6.27ms
2026-01-14 00:56:38,996 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/analytics/cost-breakdown "HTTP/1.1 200 OK"
2026-01-14 00:56:39,000 - app.core.middleware - INFO - REQ_START: GET /api/v1/analytics/requests
2026-01-14 00:56:39,006 - app.core.middleware - INFO - REQ_END: GET /api/v1/analytics/requests Status: 200 Duration: 6.06ms
2026-01-14 00:56:39,007 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/analytics/requests "HTTP/1.1 200 OK"
2026-01-14 00:56:39,011 - app.core.cache.service - INFO - Cache MISS for key: 799bcfda... (user: None)
2026-01-14 00:56:39,011 - app.core.cache.service - INFO - Stored response in cache with key: 799bcfda... (user: None)
2026-01-14 00:56:39,011 - app.core.cache.service - INFO - Cache HIT for key: 799bcfda... (user: None)
2026-01-14 00:56:39,013 - app.core.cache.service - INFO - Stored response in cache with key: 13c94c6d... (user: None)
2026-01-14 00:56:39,013 - app.core.cache.service - INFO - Stored response in cache with key: 899c4bff... (user: None)
2026-01-14 00:56:39,013 - app.core.cache.service - INFO - Cache HIT for key: 13c94c6d... (user: None)
2026-01-14 00:56:39,013 - app.core.cache.service - INFO - Cache HIT for key: 899c4bff... (user: None)
2026-01-14 00:56:39,013 - app.core.cache.service - INFO - Stored response in cache with key: 84955494... (user: None)
2026-01-14 00:56:39,013 - app.core.cache.service - INFO - Cache HIT for key: 84955494... (user: None)
2026-01-14 00:56:39,015 - app.core.cache.service - INFO - Stored response in cache with key: 7dacefc0... (user: None)
2026-01-14 00:56:39,015 - app.core.cache.service - INFO - Cache HIT for key: 7dacefc0... (user: None)
2026-01-14 00:56:40,116 - app.core.cache.service - INFO - Cache MISS for key: 7dacefc0... (user: None)
2026-01-14 00:56:40,120 - app.core.middleware - INFO - REQ_START: GET /success
2026-01-14 00:56:40,122 - app.core.middleware - INFO - REQ_END: GET /success Status: 200 Duration: 0.00ms
2026-01-14 00:56:40,123 - httpx - INFO - HTTP Request: GET http://testserver/success "HTTP/1.1 200 OK"
2026-01-14 00:56:40,127 - app.core.middleware - INFO - REQ_START: GET /error/http
2026-01-14 00:56:40,128 - app.core.errors - WARNING - HTTP error 404 at http://testserver/error/http: Item not found
2026-01-14 00:56:40,128 - app.core.middleware - INFO - REQ_END: GET /error/http Status: 404 Duration: 1.00ms
2026-01-14 00:56:40,129 - httpx - INFO - HTTP Request: GET http://testserver/error/http "HTTP/1.1 404 Not Found"
2026-01-14 00:56:40,136 - app.core.middleware - INFO - REQ_START: POST /error/validation
2026-01-14 00:56:40,137 - app.core.errors - WARNING - Validation error at http://testserver/error/validation: [{'type': 'string_too_short', 'loc': ('body', 'name'), 'msg': 'String should have at least 3 characters', 'input': 'a', 'ctx': {'min_length': 3}, 'url': 'https://errors.pydantic.dev/2.10/v/string_too_short'}]
2026-01-14 00:56:40,138 - app.core.middleware - INFO - REQ_END: POST /error/validation Status: 422 Duration: 2.00ms
2026-01-14 00:56:40,138 - httpx - INFO - HTTP Request: POST http://testserver/error/validation "HTTP/1.1 422 Unprocessable Entity"
2026-01-14 00:56:40,143 - app.core.middleware - INFO - REQ_START: GET /error/general
2026-01-14 00:56:40,144 - app.core.middleware - ERROR - REQ_FAIL: GET /error/general Duration: 1.03ms Error: Boom
2026-01-14 00:56:40,144 - app.core.errors - ERROR - Unexpected error at http://testserver/error/general: Boom
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
  |     yield
  |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 190, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 189, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_utils.py", line 91, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 44, in dispatch
    |     raise e
    |   File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 20, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 165, in call_next
    |     raise app_exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 151, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    |     raise exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 762, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 782, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 297, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 77, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    |     raise exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 72, in app
    |     response = await func(request)
    |                ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 299, in app
    |     raise e
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 294, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\core\test_middleware_errors.py", line 39, in general_error
    |     raise Exception("Boom")
    | Exception: Boom
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 189, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_utils.py", line 91, in collapse_excgroups
    raise exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 44, in dispatch
    raise e
  File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 20, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 762, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 782, in app
    await route.handle(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 299, in app
    raise e
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 294, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\core\test_middleware_errors.py", line 39, in general_error
    raise Exception("Boom")
Exception: Boom
2026-01-14 00:56:40,152 - httpx - INFO - HTTP Request: GET http://testserver/error/general "HTTP/1.1 500 Internal Server Error"
2026-01-14 00:57:02,231 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:57:02,267 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:57:02,267 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 36.66ms
2026-01-14 00:57:02,269 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:19,469 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:19,786 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 317.12ms
2026-01-14 00:59:19,787 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:59:19,792 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:19,797 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:19,798 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 5.54ms
2026-01-14 00:59:19,798 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:19,799 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:19,803 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:19,804 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 4.98ms
2026-01-14 00:59:19,804 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:20,981 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:21,295 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 313.63ms
2026-01-14 00:59:21,296 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:59:21,297 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:21,589 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 292.77ms
2026-01-14 00:59:21,590 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:21,593 - app.core.middleware - INFO - REQ_START: POST /api/v1/chat/completions
2026-01-14 00:59:21,608 - app.api.v1.endpoints.gateway - INFO - Request classification: {"complexity":"simple","tokens":10,"detected_features":[],"recommended_provider":"openai","reasoning":"Mocked for test"}
2026-01-14 00:59:21,610 - app.core.cache.service - INFO - Cache MISS for key: eb3050d9... (user: 1dc610ee-5721-440f-b944-ec5edcacc366)
2026-01-14 00:59:21,611 - app.api.v1.endpoints.gateway - INFO - Routing result: {"selected_model_id":"gpt-4o-mini","fallback_models":["gpt-4o","gpt-4-turbo"],"reasoning":"Selected gpt-4o-mini with score 81.25. Strategy: RoutingStrategy.BALANCED","strategy_used":"balanced"}
2026-01-14 00:59:21,611 - app.core.cache.service - INFO - Stored response in cache with key: eb3050d9... (user: 1dc610ee-5721-440f-b944-ec5edcacc366)
2026-01-14 00:59:21,621 - app.core.middleware - INFO - REQ_END: POST /api/v1/chat/completions Status: 200 Duration: 28.56ms
2026-01-14 00:59:21,625 - httpx - INFO - HTTP Request: POST http://test/api/v1/chat/completions "HTTP/1.1 200 OK"
2026-01-14 00:59:21,633 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:21,925 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 292.01ms
2026-01-14 00:59:21,925 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:59:21,926 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:22,179 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 252.88ms
2026-01-14 00:59:22,180 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:22,181 - app.core.middleware - INFO - REQ_START: POST /api/v1/chat/completions
2026-01-14 00:59:22,197 - app.api.v1.endpoints.gateway - INFO - Request classification: {"complexity":"simple","tokens":10,"detected_features":[],"recommended_provider":"openai","reasoning":"Mocked for test"}
2026-01-14 00:59:22,198 - app.core.cache.service - INFO - Cache MISS for key: b948bfe3... (user: 585e5828-5f55-4cb5-8469-a5ef4a3bb2fe)
2026-01-14 00:59:22,202 - app.api.v1.endpoints.gateway - ERROR - Gateway logic error: No models available that match requirements.
2026-01-14 00:59:22,204 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/chat/completions: No models available that match requirements.
2026-01-14 00:59:22,204 - app.core.middleware - INFO - REQ_END: POST /api/v1/chat/completions Status: 400 Duration: 23.61ms
2026-01-14 00:59:22,206 - httpx - INFO - HTTP Request: POST http://test/api/v1/chat/completions "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:22,213 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:22,219 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:22,220 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 7.23ms
2026-01-14 00:59:22,221 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:22,221 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:22,508 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 287.19ms
2026-01-14 00:59:22,509 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:22,509 - app.core.middleware - INFO - REQ_START: POST /api/v1/keys/
2026-01-14 00:59:22,525 - app.core.middleware - INFO - REQ_END: POST /api/v1/keys/ Status: 200 Duration: 15.91ms
2026-01-14 00:59:22,525 - httpx - INFO - HTTP Request: POST http://test/api/v1/keys/ "HTTP/1.1 200 OK"
2026-01-14 00:59:22,527 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/
2026-01-14 00:59:22,533 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/ Status: 200 Duration: 6.55ms
2026-01-14 00:59:22,535 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/ "HTTP/1.1 200 OK"
2026-01-14 00:59:22,536 - app.core.middleware - INFO - REQ_START: DELETE /api/v1/keys/5dcafa07-d21e-40a0-a4c3-e1ba0b4e8124
2026-01-14 00:59:22,554 - app.core.middleware - INFO - REQ_END: DELETE /api/v1/keys/5dcafa07-d21e-40a0-a4c3-e1ba0b4e8124 Status: 200 Duration: 17.49ms
2026-01-14 00:59:22,555 - httpx - INFO - HTTP Request: DELETE http://test/api/v1/keys/5dcafa07-d21e-40a0-a4c3-e1ba0b4e8124 "HTTP/1.1 200 OK"
2026-01-14 00:59:22,555 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/
2026-01-14 00:59:22,564 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/ Status: 200 Duration: 8.88ms
2026-01-14 00:59:22,565 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/ "HTTP/1.1 200 OK"
2026-01-14 00:59:22,577 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:22,584 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:22,584 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 7.09ms
2026-01-14 00:59:22,586 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:22,586 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:22,836 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 249.88ms
2026-01-14 00:59:22,837 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:22,837 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/logout
2026-01-14 00:59:22,851 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/logout Status: 200 Duration: 14.01ms
2026-01-14 00:59:22,851 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/logout "HTTP/1.1 200 OK"
2026-01-14 00:59:22,851 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/logout
2026-01-14 00:59:22,855 - app.core.errors - WARNING - HTTP error 401 at http://test/api/v1/auth/logout: Token has been revoked
2026-01-14 00:59:22,855 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/logout Status: 401 Duration: 3.73ms
2026-01-14 00:59:22,855 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/logout "HTTP/1.1 401 Unauthorized"
2026-01-14 00:59:22,860 - app.core.middleware - INFO - REQ_START: GET /health
2026-01-14 00:59:22,861 - app.core.middleware - INFO - REQ_END: GET /health Status: 200 Duration: 1.01ms
2026-01-14 00:59:22,863 - httpx - INFO - HTTP Request: GET http://test/health "HTTP/1.1 200 OK"
2026-01-14 00:59:22,866 - app.core.middleware - INFO - REQ_START: GET /
2026-01-14 00:59:22,868 - app.core.middleware - INFO - REQ_END: GET / Status: 200 Duration: 1.53ms
2026-01-14 00:59:22,869 - httpx - INFO - HTTP Request: GET http://test/ "HTTP/1.1 200 OK"
2026-01-14 00:59:22,873 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:22,877 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:22,879 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 5.24ms
2026-01-14 00:59:22,879 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:22,880 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:23,144 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 264.05ms
2026-01-14 00:59:23,145 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:23,146 - app.core.middleware - INFO - REQ_START: POST /api/v1/keys/providers/add
2026-01-14 00:59:23,169 - app.core.middleware - INFO - REQ_END: POST /api/v1/keys/providers/add Status: 200 Duration: 22.32ms
2026-01-14 00:59:23,170 - httpx - INFO - HTTP Request: POST http://test/api/v1/keys/providers/add "HTTP/1.1 200 OK"
2026-01-14 00:59:23,171 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/providers/list
2026-01-14 00:59:23,176 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/providers/list Status: 200 Duration: 5.14ms
2026-01-14 00:59:23,176 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/providers/list "HTTP/1.1 200 OK"
2026-01-14 00:59:23,177 - app.core.middleware - INFO - REQ_START: DELETE /api/v1/keys/providers/158d87ae-61c3-4516-b36d-1b200f6454d0
2026-01-14 00:59:23,188 - app.core.middleware - INFO - REQ_END: DELETE /api/v1/keys/providers/158d87ae-61c3-4516-b36d-1b200f6454d0 Status: 200 Duration: 11.08ms
2026-01-14 00:59:23,189 - httpx - INFO - HTTP Request: DELETE http://test/api/v1/keys/providers/158d87ae-61c3-4516-b36d-1b200f6454d0 "HTTP/1.1 200 OK"
2026-01-14 00:59:23,190 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/providers/list
2026-01-14 00:59:23,194 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/providers/list Status: 200 Duration: 4.13ms
2026-01-14 00:59:23,196 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/providers/list "HTTP/1.1 200 OK"
2026-01-14 00:59:24,551 - app.core.registry - INFO - Loaded 1 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 00:59:24,559 - app.core.registry - INFO - Loaded 1 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 00:59:24,567 - app.core.registry - INFO - Loaded 1 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 00:59:25,671 - app.core.registry - INFO - Loaded 2 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 00:59:26,709 - app.core.middleware - INFO - REQ_START: GET /api/v1/analytics/overview
2026-01-14 00:59:26,732 - app.core.middleware - INFO - REQ_END: GET /api/v1/analytics/overview Status: 200 Duration: 22.92ms
2026-01-14 00:59:26,736 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/analytics/overview "HTTP/1.1 200 OK"
2026-01-14 00:59:26,745 - app.core.middleware - INFO - REQ_START: GET /api/v1/analytics/cost-breakdown
2026-01-14 00:59:26,762 - app.core.middleware - INFO - REQ_END: GET /api/v1/analytics/cost-breakdown Status: 200 Duration: 16.51ms
2026-01-14 00:59:26,766 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/analytics/cost-breakdown "HTTP/1.1 200 OK"
2026-01-14 00:59:26,777 - app.core.middleware - INFO - REQ_START: GET /api/v1/analytics/requests
2026-01-14 00:59:26,790 - app.core.middleware - INFO - REQ_END: GET /api/v1/analytics/requests Status: 200 Duration: 13.53ms
2026-01-14 00:59:26,795 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/analytics/requests "HTTP/1.1 200 OK"
2026-01-14 00:59:26,803 - app.core.cache.service - INFO - Cache MISS for key: 799bcfda... (user: None)
2026-01-14 00:59:26,804 - app.core.cache.service - INFO - Stored response in cache with key: 799bcfda... (user: None)
2026-01-14 00:59:26,804 - app.core.cache.service - INFO - Cache HIT for key: 799bcfda... (user: None)
2026-01-14 00:59:26,809 - app.core.cache.service - INFO - Stored response in cache with key: 13c94c6d... (user: None)
2026-01-14 00:59:26,810 - app.core.cache.service - INFO - Stored response in cache with key: 899c4bff... (user: None)
2026-01-14 00:59:26,810 - app.core.cache.service - INFO - Cache HIT for key: 13c94c6d... (user: None)
2026-01-14 00:59:26,810 - app.core.cache.service - INFO - Cache HIT for key: 899c4bff... (user: None)
2026-01-14 00:59:26,810 - app.core.cache.service - INFO - Stored response in cache with key: 84955494... (user: None)
2026-01-14 00:59:26,810 - app.core.cache.service - INFO - Cache HIT for key: 84955494... (user: None)
2026-01-14 00:59:26,816 - app.core.cache.service - INFO - Stored response in cache with key: 7dacefc0... (user: None)
2026-01-14 00:59:26,817 - app.core.cache.service - INFO - Cache HIT for key: 7dacefc0... (user: None)
2026-01-14 00:59:27,918 - app.core.cache.service - INFO - Cache MISS for key: 7dacefc0... (user: None)
2026-01-14 00:59:27,937 - app.core.middleware - INFO - REQ_START: GET /success
2026-01-14 00:59:27,940 - app.core.middleware - INFO - REQ_END: GET /success Status: 200 Duration: 1.73ms
2026-01-14 00:59:27,950 - httpx - INFO - HTTP Request: GET http://testserver/success "HTTP/1.1 200 OK"
2026-01-14 00:59:27,964 - app.core.middleware - INFO - REQ_START: GET /error/http
2026-01-14 00:59:27,967 - app.core.errors - WARNING - HTTP error 404 at http://testserver/error/http: Item not found
2026-01-14 00:59:27,967 - app.core.middleware - INFO - REQ_END: GET /error/http Status: 404 Duration: 3.48ms
2026-01-14 00:59:27,971 - httpx - INFO - HTTP Request: GET http://testserver/error/http "HTTP/1.1 404 Not Found"
2026-01-14 00:59:27,993 - app.core.middleware - INFO - REQ_START: POST /error/validation
2026-01-14 00:59:27,998 - app.core.errors - WARNING - Validation error at http://testserver/error/validation: [{'type': 'string_too_short', 'loc': ('body', 'name'), 'msg': 'String should have at least 3 characters', 'input': 'a', 'ctx': {'min_length': 3}, 'url': 'https://errors.pydantic.dev/2.10/v/string_too_short'}]
2026-01-14 00:59:28,000 - app.core.middleware - INFO - REQ_END: POST /error/validation Status: 422 Duration: 6.51ms
2026-01-14 00:59:28,010 - httpx - INFO - HTTP Request: POST http://testserver/error/validation "HTTP/1.1 422 Unprocessable Entity"
2026-01-14 00:59:28,049 - app.core.middleware - INFO - REQ_START: GET /error/general
2026-01-14 00:59:28,051 - app.core.middleware - ERROR - REQ_FAIL: GET /error/general Duration: 2.01ms Error: Boom
2026-01-14 00:59:28,052 - app.core.errors - ERROR - Unexpected error at http://testserver/error/general: Boom
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
  |     yield
  |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 190, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 189, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_utils.py", line 91, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 44, in dispatch
    |     raise e
    |   File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 20, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 165, in call_next
    |     raise app_exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 151, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    |     raise exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 762, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 782, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 297, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 77, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    |     raise exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 72, in app
    |     response = await func(request)
    |                ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 299, in app
    |     raise e
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 294, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\core\test_middleware_errors.py", line 39, in general_error
    |     raise Exception("Boom")
    | Exception: Boom
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 189, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_utils.py", line 91, in collapse_excgroups
    raise exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 44, in dispatch
    raise e
  File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 20, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 762, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 782, in app
    await route.handle(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 299, in app
    raise e
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 294, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\core\test_middleware_errors.py", line 39, in general_error
    raise Exception("Boom")
Exception: Boom
2026-01-14 00:59:28,073 - httpx - INFO - HTTP Request: GET http://testserver/error/general "HTTP/1.1 500 Internal Server Error"
2026-01-14 00:59:52,909 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:53,250 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 340.94ms
2026-01-14 00:59:53,253 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:59:53,260 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:53,268 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:53,268 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 8.12ms
2026-01-14 00:59:53,269 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:53,270 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:53,275 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:53,275 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 5.55ms
2026-01-14 00:59:53,277 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:55,453 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:55,964 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 510.16ms
2026-01-14 00:59:55,966 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:59:55,967 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:56,659 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 691.99ms
2026-01-14 00:59:56,662 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:56,667 - app.core.middleware - INFO - REQ_START: POST /api/v1/chat/completions
2026-01-14 00:59:56,711 - app.api.v1.endpoints.gateway - INFO - Request classification: {"complexity":"simple","tokens":10,"detected_features":[],"recommended_provider":"openai","reasoning":"Mocked for test"}
2026-01-14 00:59:56,716 - app.core.cache.service - INFO - Cache MISS for key: 60da9552... (user: 25c7181a-bc96-437d-95f5-5d0eec28209c)
2026-01-14 00:59:56,717 - app.api.v1.endpoints.gateway - INFO - Routing result: {"selected_model_id":"gpt-4o-mini","fallback_models":["gpt-4o","gpt-4-turbo"],"reasoning":"Selected gpt-4o-mini with score 81.25. Strategy: RoutingStrategy.BALANCED","strategy_used":"balanced"}
2026-01-14 00:59:56,718 - app.core.cache.service - INFO - Stored response in cache with key: 60da9552... (user: 25c7181a-bc96-437d-95f5-5d0eec28209c)
2026-01-14 00:59:56,738 - app.core.middleware - INFO - REQ_END: POST /api/v1/chat/completions Status: 200 Duration: 70.92ms
2026-01-14 00:59:56,740 - httpx - INFO - HTTP Request: POST http://test/api/v1/chat/completions "HTTP/1.1 200 OK"
2026-01-14 00:59:56,762 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:57,104 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 201 Duration: 342.94ms
2026-01-14 00:59:57,106 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 201 Created"
2026-01-14 00:59:57,108 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:57,462 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 353.70ms
2026-01-14 00:59:57,464 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:57,464 - app.core.middleware - INFO - REQ_START: POST /api/v1/chat/completions
2026-01-14 00:59:57,484 - app.api.v1.endpoints.gateway - INFO - Request classification: {"complexity":"simple","tokens":10,"detected_features":[],"recommended_provider":"openai","reasoning":"Mocked for test"}
2026-01-14 00:59:57,488 - app.core.cache.service - INFO - Cache MISS for key: 6eb3944f... (user: 6ac6cafd-5dbe-48d4-ac7b-71642333aa13)
2026-01-14 00:59:57,492 - app.api.v1.endpoints.gateway - ERROR - Gateway logic error: No models available that match requirements.
2026-01-14 00:59:57,493 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/chat/completions: No models available that match requirements.
2026-01-14 00:59:57,494 - app.core.middleware - INFO - REQ_END: POST /api/v1/chat/completions Status: 400 Duration: 29.91ms
2026-01-14 00:59:57,497 - httpx - INFO - HTTP Request: POST http://test/api/v1/chat/completions "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:57,512 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:57,529 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:57,531 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 18.75ms
2026-01-14 00:59:57,533 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:57,534 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:57,875 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 341.82ms
2026-01-14 00:59:57,877 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:57,880 - app.core.middleware - INFO - REQ_START: POST /api/v1/keys/
2026-01-14 00:59:57,906 - app.core.middleware - INFO - REQ_END: POST /api/v1/keys/ Status: 200 Duration: 26.29ms
2026-01-14 00:59:57,907 - httpx - INFO - HTTP Request: POST http://test/api/v1/keys/ "HTTP/1.1 200 OK"
2026-01-14 00:59:57,909 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/
2026-01-14 00:59:57,924 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/ Status: 200 Duration: 14.86ms
2026-01-14 00:59:57,927 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/ "HTTP/1.1 200 OK"
2026-01-14 00:59:57,930 - app.core.middleware - INFO - REQ_START: DELETE /api/v1/keys/313b659c-e4fb-4dc1-9f0b-772d5999637d
2026-01-14 00:59:57,959 - app.core.middleware - INFO - REQ_END: DELETE /api/v1/keys/313b659c-e4fb-4dc1-9f0b-772d5999637d Status: 200 Duration: 29.12ms
2026-01-14 00:59:57,962 - httpx - INFO - HTTP Request: DELETE http://test/api/v1/keys/313b659c-e4fb-4dc1-9f0b-772d5999637d "HTTP/1.1 200 OK"
2026-01-14 00:59:57,963 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/
2026-01-14 00:59:57,976 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/ Status: 200 Duration: 13.18ms
2026-01-14 00:59:57,978 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/ "HTTP/1.1 200 OK"
2026-01-14 00:59:58,007 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:58,018 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:58,018 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 10.72ms
2026-01-14 00:59:58,019 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:58,022 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:58,367 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 344.94ms
2026-01-14 00:59:58,369 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:58,373 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/logout
2026-01-14 00:59:58,395 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/logout Status: 200 Duration: 21.55ms
2026-01-14 00:59:58,398 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/logout "HTTP/1.1 200 OK"
2026-01-14 00:59:58,398 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/logout
2026-01-14 00:59:58,404 - app.core.errors - WARNING - HTTP error 401 at http://test/api/v1/auth/logout: Token has been revoked
2026-01-14 00:59:58,405 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/logout Status: 401 Duration: 7.60ms
2026-01-14 00:59:58,407 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/logout "HTTP/1.1 401 Unauthorized"
2026-01-14 00:59:58,417 - app.core.middleware - INFO - REQ_START: GET /health
2026-01-14 00:59:58,421 - app.core.middleware - INFO - REQ_END: GET /health Status: 200 Duration: 4.17ms
2026-01-14 00:59:58,424 - httpx - INFO - HTTP Request: GET http://test/health "HTTP/1.1 200 OK"
2026-01-14 00:59:58,435 - app.core.middleware - INFO - REQ_START: GET /
2026-01-14 00:59:58,439 - app.core.middleware - INFO - REQ_END: GET / Status: 200 Duration: 4.35ms
2026-01-14 00:59:58,440 - httpx - INFO - HTTP Request: GET http://test/ "HTTP/1.1 200 OK"
2026-01-14 00:59:58,455 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/signup
2026-01-14 00:59:58,464 - app.core.errors - WARNING - HTTP error 400 at http://test/api/v1/auth/signup: The user with this username already exists in the system
2026-01-14 00:59:58,465 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/signup Status: 400 Duration: 11.01ms
2026-01-14 00:59:58,467 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2026-01-14 00:59:58,468 - app.core.middleware - INFO - REQ_START: POST /api/v1/auth/login
2026-01-14 00:59:58,786 - app.core.middleware - INFO - REQ_END: POST /api/v1/auth/login Status: 200 Duration: 318.20ms
2026-01-14 00:59:58,788 - httpx - INFO - HTTP Request: POST http://test/api/v1/auth/login "HTTP/1.1 200 OK"
2026-01-14 00:59:58,792 - app.core.middleware - INFO - REQ_START: POST /api/v1/keys/providers/add
2026-01-14 00:59:58,840 - app.core.middleware - INFO - REQ_END: POST /api/v1/keys/providers/add Status: 200 Duration: 48.61ms
2026-01-14 00:59:58,842 - httpx - INFO - HTTP Request: POST http://test/api/v1/keys/providers/add "HTTP/1.1 200 OK"
2026-01-14 00:59:58,844 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/providers/list
2026-01-14 00:59:58,856 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/providers/list Status: 200 Duration: 13.28ms
2026-01-14 00:59:58,859 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/providers/list "HTTP/1.1 200 OK"
2026-01-14 00:59:58,861 - app.core.middleware - INFO - REQ_START: DELETE /api/v1/keys/providers/01ce5af9-3594-4dc9-8d91-2161b1e4db3f
2026-01-14 00:59:58,887 - app.core.middleware - INFO - REQ_END: DELETE /api/v1/keys/providers/01ce5af9-3594-4dc9-8d91-2161b1e4db3f Status: 200 Duration: 26.21ms
2026-01-14 00:59:58,890 - httpx - INFO - HTTP Request: DELETE http://test/api/v1/keys/providers/01ce5af9-3594-4dc9-8d91-2161b1e4db3f "HTTP/1.1 200 OK"
2026-01-14 00:59:58,891 - app.core.middleware - INFO - REQ_START: GET /api/v1/keys/providers/list
2026-01-14 00:59:58,903 - app.core.middleware - INFO - REQ_END: GET /api/v1/keys/providers/list Status: 200 Duration: 11.94ms
2026-01-14 00:59:58,905 - httpx - INFO - HTTP Request: GET http://test/api/v1/keys/providers/list "HTTP/1.1 200 OK"
2026-01-14 01:00:00,909 - app.core.registry - INFO - Loaded 1 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 01:00:00,919 - app.core.registry - INFO - Loaded 1 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 01:00:00,929 - app.core.registry - INFO - Loaded 1 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 01:00:02,034 - app.core.registry - INFO - Loaded 2 models from C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\test_models.json
2026-01-14 01:00:03,060 - app.core.middleware - INFO - REQ_START: GET /api/v1/analytics/overview
2026-01-14 01:00:03,072 - app.core.middleware - INFO - REQ_END: GET /api/v1/analytics/overview Status: 200 Duration: 13.44ms
2026-01-14 01:00:03,075 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/analytics/overview "HTTP/1.1 200 OK"
2026-01-14 01:00:03,082 - app.core.middleware - INFO - REQ_START: GET /api/v1/analytics/cost-breakdown
2026-01-14 01:00:03,092 - app.core.middleware - INFO - REQ_END: GET /api/v1/analytics/cost-breakdown Status: 200 Duration: 8.31ms
2026-01-14 01:00:03,095 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/analytics/cost-breakdown "HTTP/1.1 200 OK"
2026-01-14 01:00:03,101 - app.core.middleware - INFO - REQ_START: GET /api/v1/analytics/requests
2026-01-14 01:00:03,110 - app.core.middleware - INFO - REQ_END: GET /api/v1/analytics/requests Status: 200 Duration: 9.43ms
2026-01-14 01:00:03,113 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/analytics/requests "HTTP/1.1 200 OK"
2026-01-14 01:00:03,119 - app.core.cache.service - INFO - Cache MISS for key: 799bcfda... (user: None)
2026-01-14 01:00:03,119 - app.core.cache.service - INFO - Stored response in cache with key: 799bcfda... (user: None)
2026-01-14 01:00:03,120 - app.core.cache.service - INFO - Cache HIT for key: 799bcfda... (user: None)
2026-01-14 01:00:03,122 - app.core.cache.service - INFO - Stored response in cache with key: 13c94c6d... (user: None)
2026-01-14 01:00:03,123 - app.core.cache.service - INFO - Stored response in cache with key: 899c4bff... (user: None)
2026-01-14 01:00:03,124 - app.core.cache.service - INFO - Cache HIT for key: 13c94c6d... (user: None)
2026-01-14 01:00:03,124 - app.core.cache.service - INFO - Cache HIT for key: 899c4bff... (user: None)
2026-01-14 01:00:03,124 - app.core.cache.service - INFO - Stored response in cache with key: 84955494... (user: None)
2026-01-14 01:00:03,124 - app.core.cache.service - INFO - Cache HIT for key: 84955494... (user: None)
2026-01-14 01:00:03,127 - app.core.cache.service - INFO - Stored response in cache with key: 7dacefc0... (user: None)
2026-01-14 01:00:03,127 - app.core.cache.service - INFO - Cache HIT for key: 7dacefc0... (user: None)
2026-01-14 01:00:04,228 - app.core.cache.service - INFO - Cache MISS for key: 7dacefc0... (user: None)
2026-01-14 01:00:04,235 - app.core.middleware - INFO - REQ_START: GET /success
2026-01-14 01:00:04,236 - app.core.middleware - INFO - REQ_END: GET /success Status: 200 Duration: 0.00ms
2026-01-14 01:00:04,237 - httpx - INFO - HTTP Request: GET http://testserver/success "HTTP/1.1 200 OK"
2026-01-14 01:00:04,244 - app.core.middleware - INFO - REQ_START: GET /error/http
2026-01-14 01:00:04,245 - app.core.errors - WARNING - HTTP error 404 at http://testserver/error/http: Item not found
2026-01-14 01:00:04,245 - app.core.middleware - INFO - REQ_END: GET /error/http Status: 404 Duration: 1.00ms
2026-01-14 01:00:04,247 - httpx - INFO - HTTP Request: GET http://testserver/error/http "HTTP/1.1 404 Not Found"
2026-01-14 01:00:04,255 - app.core.middleware - INFO - REQ_START: POST /error/validation
2026-01-14 01:00:04,257 - app.core.errors - WARNING - Validation error at http://testserver/error/validation: [{'type': 'string_too_short', 'loc': ('body', 'name'), 'msg': 'String should have at least 3 characters', 'input': 'a', 'ctx': {'min_length': 3}, 'url': 'https://errors.pydantic.dev/2.10/v/string_too_short'}]
2026-01-14 01:00:04,258 - app.core.middleware - INFO - REQ_END: POST /error/validation Status: 422 Duration: 3.02ms
2026-01-14 01:00:04,261 - httpx - INFO - HTTP Request: POST http://testserver/error/validation "HTTP/1.1 422 Unprocessable Entity"
2026-01-14 01:00:04,267 - app.core.middleware - INFO - REQ_START: GET /error/general
2026-01-14 01:00:04,268 - app.core.middleware - ERROR - REQ_FAIL: GET /error/general Duration: 1.52ms Error: Boom
2026-01-14 01:00:04,268 - app.core.errors - ERROR - Unexpected error at http://testserver/error/general: Boom
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
  |     yield
  |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 190, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 189, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_utils.py", line 91, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 44, in dispatch
    |     raise e
    |   File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 20, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 165, in call_next
    |     raise app_exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 151, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    |     raise exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 762, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 782, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 297, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 77, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    |     raise exc
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 72, in app
    |     response = await func(request)
    |                ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 299, in app
    |     raise e
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 294, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\core\test_middleware_errors.py", line 39, in general_error
    |     raise Exception("Boom")
    | Exception: Boom
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 189, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_utils.py", line 91, in collapse_excgroups
    raise exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 44, in dispatch
    raise e
  File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\app\core\middleware.py", line 20, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 762, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 782, in app
    await route.handle(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 299, in app
    raise e
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 294, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\raul_\.claude-worktrees\Gateway-IA\friendly-mayer\backend\tests\core\test_middleware_errors.py", line 39, in general_error
    raise Exception("Boom")
Exception: Boom
2026-01-14 01:00:04,281 - httpx - INFO - HTTP Request: GET http://testserver/error/general "HTTP/1.1 500 Internal Server Error"
